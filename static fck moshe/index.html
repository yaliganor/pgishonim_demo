<!DOCTYPE html>
<html lang="he">
<meta charset="UTF-8">
<head>
    <title>צור תמונה</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: center;
            margin-top: 50px;
        }

        input {
            font-size: 18px;
            padding: 5px;
        }

        button {
            font-size: 18px;
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
        }

        canvas {
            display: block;
            margin: 20px auto;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <h2>מלא שם:</h2>
    <input id="nameInput" placeholder="הכנס שם">
    <br>
    <button onclick="createImage()">צור תמונה</button>

    <!-- NEW BUTTON HERE -->
    <br><br>
    <button onclick="createValiV()">באלי וי</button>

    <canvas id="canvas"></canvas>
    <br>
    <a id="downloadLink" style="display:none;" download="output.png">הורד את התמונה</a>

    <script>
        function createImage() {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) { alert("אנא הכנס שם"); return; }

            const img = new Image();
            img.src = 'static/template.png';
            img.onload = function () {
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext('2d');

                canvas.width = img.width * 0.8;
                canvas.height = img.height * 0.8;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();
                const dateStr = `${day}/${month}/${year}`;
                const timeStr = now.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });

                ctx.fillStyle = "#6f7e89";
                ctx.textBaseline = "middle";

                ctx.font = `bold ${55 * 0.8}px Arial`;
                ctx.textAlign = "left";
                ctx.fillText(timeStr, canvas.width * 0.07, canvas.height * 0.385);

                ctx.fillText(dateStr, canvas.width * 0.65, canvas.height * 0.385);

                ctx.textAlign = "right";
                ctx.direction = "rtl";

                let maxWidth = canvas.width * 0.17;
                let fontSize = 55 * 0.8;
                ctx.font = `bold ${fontSize}px Arial`;

                while (ctx.measureText(name).width > maxWidth && fontSize > 10) {
                    fontSize -= 1;
                    ctx.font = `bold ${fontSize}px Arial`;
                }

                ctx.fillText(name, canvas.width * 0.90, canvas.height * 0.445);

                const link = document.getElementById('downloadLink');
                link.href = canvas.toDataURL("image/png");
                link.style.display = "inline";
            };
        }

        /* ----------------------------------------- */
        /* NEW FUNCTION: "באלי וי" BUTTON */
        /* ----------------------------------------- */

        function createValiV() {
            let name = prompt("הכנס שם:");
            if (!name) return;

            let userClass = prompt("הכנס כיתה:");
            if (!userClass) return;

            const img = new Image();
            img.src = 'static/V.png';   // Make sure V.png is in the same folder

            img.onload = function () {
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext('2d');

                canvas.width = img.width;
                canvas.height = img.height;

                ctx.drawImage(img, 0, 0);

                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = String(now.getFullYear()).slice(-2);

                const dateStr = `${day}/${month}/${year}`;

                let startHour = now.getHours();
                let endHour = startHour + 2;
                const hourStr = `${startHour}:00-${endHour}:00`;

                ctx.font = "25px Arial";
                ctx.fillStyle = "black";
                ctx.textAlign = "left";

                ctx.fillText(`${dateStr}`, 357, 217);
                ctx.fillText(`${hourStr}`, 60, 217);
                ctx.fillText(`${startHour}:00`, 345, 448);
                ctx.fillText(`${endHour}:00`, 50, 448);
                ctx.fillText(`${userClass}`, 60, 273);
                ctx.fillText(`${name}`, 357, 273);

                const link = document.getElementById('downloadLink');
                link.href = canvas.toDataURL();
                link.download = "V_filled.png";
                link.style.display = "inline";
            };
        }
    </script>

</body>
</html>
